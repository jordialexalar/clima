
       /*MODULO   FEDIT1.C        */


       /*Contiene funciones para edicion de t‚cnicas*/


#include <fdefines.h>
#include <fexterns.h>
#include <string.h>
#include <stdio.h>
extern int len(char *p);


  edit(pul)
  int pul;
  {
    int i;
    int ji;
    int h;
    int t;
    int err=0;
    int ord=0;
    int posh;
    int posv;
    int num;
    int tec;
    int referencia=0;
    int hy;


    char cadena[20];
    char ctexto[20];
    char text[20];
    int numero;
    int salir=0;
    int salir1=0;
    int salir2=0;
    double floatnum;
    double flot;

      borrar_tecnica(pul);

      while (salir==0)
      {
	  borrar();

	  say(1,0,txt_prog[0]);

          apunta(pul,IDEN);

	  err=get(1,len(txt_prog[0]),pficher,3,1,1,0);
	      if (err==3)
		{
		  lista_pant(codigos,pos_ini_cod,pos_ini_cod+num_codigos,10,1,1,2,0);
		  lastkey=0x00;
		 }
	       else
		{
		   if (err==novalid)
		      return;
		   else
		   { apunta(pul,IDEN);
		     num=arint(pficher);
		     if ((num>=0 && num <=num_codigos-1) && *pficher!=0x00)
		       {
			   salir=1;
			}

		   }
		}
       }


      salir1=0;
      while (salir1==0)
      {
      borrar();
      say(1,0,txt_prog[1]);
      if (modelo==CLIMA_JR)
	lista_pant(tipos,0,6,7,2,0,3,0);
      else
	lista_pant(tipos,0,7,7,2,0,3,0);
      apunta(pul,TIPO);

      err=get(1,len(txt_prog[1]),pficher,1,1,1,0);
      h=arflot(pficher);

      if (err==novalid)
       return;
      if (*pficher!=0x00 && ((h<7 && modelo !=CLIMA_JR)||(h<6 && modelo==CLIMA_JR)))
	 salir1=1;
      }

      if (h==CIN || h==MSTD || h==ABS)
       {
	 escribe(pul,CONTRA_FACTOR,"1");
       }
      if (h==MSTD)
	{
	 referencia=busca_pos_puntos();
	 if (referencia==100)
	   {
		 return;
	   }
	 else
	   {
	     apuntastd(referencia,0,0,0);
	     for(i=0;i<long_ficha_std;i++)
	       {
		*pficherstd=0x00;
		pficherstd=pficherstd+1;
	       }
	    }

	}




       for (i=0;parametros[i+(h*20)]!=FIN;i++)
	{
         if (err==novalid)
	  break;

	 borrar();

          ord=parametros[i+(h*20)];

	 ji=i+2;

         if (ord!=NADA)
	 {
         numero=0;
	 floatnum=0.0;

         apunta(pul,ord);

	 switch (ord) {

	    case WL1:
	       say(1,0,txt_prog[ord]);
	      lista_pant(wl,1,n_filtros_tamb+1,7,2,0,3,1);
	      err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
	      numero=arint(pficher);
	      if (numero<1 || numero>n_filtros_tamb)
		i--;
	      break;



	    case WL2:
	      say(1,0,txt_prog[ord]);
	      lista_pant(wl,1,n_filtros_tamb+1,7,2,0,3,1);
	      err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
	      numero=arint(pficher);
	      if (numero<1 || numero>n_filtros_tamb)
		 {
		  escribe(pul,WL2,"0");
		  break;
		 }
	      break;





	    case UNITS:
	      say(1,0,txt_prog[ord]);
	      err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
              if (err==3)
                {
		  lista_pant(units,0,16,10,1,1,2,0);
		  lastkey=0x00;
		  i--;
                 }
               else
	       {

                 numero=arint(pficher);
		 if (numero<0 || numero > 15 || *pficher==0x00)
			i--;
		}
              break;



	    case TEMP:
	      say(1,0,txt_prog[ord]);
	      if (modelo==CLIMA_JR)
  	        say(2,2,textos[27+idioma_textos]);
              else
		say(2,2,textos[5+idioma_textos]);

	      err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
              numero=arint(pficher);
	      if (modelo==CLIMA_JR)
	      {
		if (numero ==1)
		   {
		     escribe(pul,TEMP,"37");
		   }
		else
		 {
		    if (numero==2)
		      {
			escribe(pul,TEMP,"TA");
		      }
		    else
		     {
		      i--;
		     }

		 }

	      }
	      else
	      {
                if (numero !=25 && numero!=30 && numero!= 37)
		  i--;
	      }
	      break;



	    case STD:
              say(1,1,textos[4+idioma_textos]);
	      tec=keyboard(0);
	      borrarl(1,0,20);
	      if (tec==stop)
		return;
              if (tec==1)
                 escribe(pul,CONTRA_FACTOR,"0");
	      else
		 escribe(pul,CONTRA_FACTOR,"1");

	      borrarl(1,0,20);

              apunta(pul,CONTRA_FACTOR);
              if (*pficher=='0')
	      {
		 apunta(pul,FACTOR);
		 *pficher='\0';
	      say(1,0,txt_prog[ord]);
	      apunta(pul,STD);
	      err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
              floatnum=arflot(pficher);
              if (floatnum<0 || floatnum >9999 || *pficher==0x00)
		i--;
	      }
              break;


	    case FACTOR:

                 apunta(pul,CONTRA_FACTOR);
	      if (*pficher=='1')
	      {
	      say(1,0,txt_prog[ord]);
	         apunta(pul,FACTOR);
	      err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
	      floatnum=arflot(pficher);
              if (floatnum<0 || floatnum >99999 || *pficher==0x00)
		i--;
	      }
              break;



	    case ABSORB_LIM:
              say(1,1,textos[3+idioma_textos]);
	      tec=keyboard(0);
	      borrarl(1,0,20);

	      if (tec==1)
	       escribe(pul,ABSORBLIMM,"1");
	      else
	       escribe(pul,ABSORBLIMM,"0");

	      if (tec==stop)
		return;
	      borrarl(1,0,20);

              salir2=0;

	      while (salir2==0)
	      {
	       borrar();
 	       apunta(pul,ABSORB_LIM);
	       say(1,0,txt_prog[ord]);
	       err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
               floatnum=arflot(pficher);
               if (floatnum < 0 || floatnum >10000 || *pficher==0x00)
	 	 {
		 salir2=0;
		 }
 	        else
		 {
 	          salir2=1;
		 }

	      if (lastkey==stop)
		salir2=1;

	      }
               break;


	    case DECIMALES:
	      say(1,0,txt_prog[ord]);
	      err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
	      numero=arint(pficher);
              if (numero<0 || numero > 3 || *pficher==0x00)
		i--;
	      break;


	    case VARIOS_STD:
	      say(1,0,txt_prog[ord]);
	      apuntastd(referencia,0,0,0);
	      err=get(1,strlen(txt_prog[ord]),pficherstd,1,1,1,0);
	      numero=arint(pficherstd);
            if (numero<2 || numero > 9 )
		i--;
              intar(text,referencia);
	      escribe(pul,VARIOS_STD,text);

              break;


            default:
	      say(1,0,txt_prog[ord]);
	      err=get(1,strlen(txt_prog[ord]),pficher,longitud[ord],1,1,0);
              floatnum=arflot(pficher);
	      if (floatnum<0 || floatnum >99999 || *pficher==0x00)
		i--;
	      break;

	  }

	 }

	      if (lastkey==stop)
		 return;


	 }
      escribe(pul,POS_GRABADA,"*");

    if (printtec==1)
	imprime_tecnica(pul);


   pul=pul;

   }
